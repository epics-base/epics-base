<html><head><title>makeAPIheader.pl</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="style.css">

</head>
<body class='pod'>
<!--
  generated by EPICS::PodHtml v,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.028001 at Fri Aug 14 17:05:18 2020 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to EPICS::PodHtml, and/or subclassing EPICS::PodHtml,
   then reconverting this document from the Pod source.
   When in doubt, email the author of EPICS::PodHtml for advice.
   See 'perldoc EPICS::PodHtml' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u'
name="NAME"
>NAME</a></h1>

<p>makeAPIheader.pl - Create a header for marking API symbols import/export</p>

<h1><a class='u'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><b>makeAPIheader.pl</b> [<b>-h</b>] [<b>-o</b> path/file<b>API.h</b>] stem</p>

<h1><a class='u'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Creates a C/C++ header file containing macro definitions for <code>STEM_API</code> and <code>epicsStdCall</code> which on Windows will expand to the appropriate <code>__declspec</code> and <code>__stdcall</code> keywords respectively,
and on GCC to a <code>visibility</code> attribute and nothing.</p>

<h1><a class='u'
name="OPTIONS"
>OPTIONS</a></h1>

<p><b>makeAPIheader.pl</b> understands the following options:</p>

<dl>
<dt><a name="-h"
><b>-h</b></a></dt>

<dd>
<p>Help,
display this document as text.</p>

<dt><a name="-o-path/fileAPI.h"
><b>-o</b> path/file<b>API.h</b></a></dt>

<dd>
<p>Pathname to the output file to be created.
Must end with <code>API.h</code>.</p>
</dd>
</dl>

<p>If no output filename is set,
the name will be generated by appending <code>API.h</code> to the <i>stem</i> argument.</p>

<p>The <i>stem</i> used must be a legal C identifier,
starting with a letter or underscore followed by any combination of digits,
letters and underscores.</p>

<h1><a class='u'
name="PURPOSE"
>PURPOSE</a></h1>

<p>The generated header and the macros in it replace the <code>epicsShare</code> macros that were defined in the <code>shareLib.h</code> header,
avoiding the need for shared library implementation code to define the <code>epicsExportSharedSymbols</code> macro in between the import and export headers.
The order of including header files no longer matters when using this approach.</p>

<p>For libraries that contain EPICS record,
device,
driver or link support and use the epicsExport.h macros to publish the associated support entry table for the IOC to locate,
switching from shareLib.h to a generated API header file is not recommended.
The old approach is simpler in these cases.</p>

<h1><a class='u'
name="USING-WITH-EPICS"
>USING WITH EPICS</a></h1>

<p>In a Makefile that is building a DLL or shared library,
set the variable <code>API_HEADER</code> to the name of the API header file to be generated.
This name must start with a legal C identifier and end with <code>API.h</code>.
The C identifier part preceeding the <code>API.h</code> is referred to here as the <i>stem</i> for this header file,
and should be a short name in lower case or camelCase.
For example the stem used in the example here is <code>libCom</code>:</p>

<pre>    # Generate our library API header file
    API_HEADER += libComAPI.h</pre>

<p>The Makefile also needs to find the API stem given the name of the library. These may be different, as shown in our example since the libCom API actually gets used by a library whose formal name is just &#34;Com&#34;. This relationship is indicated by setting the <code>library_API</code> variable to the API stem, like this:</p>

<pre>    # Library to build:
    LIBRARY = Com
    # API stem for the Com library
    Com_API = libCom</pre>

<p>Then in each header file that declares a function, global variable or C++ class or method to be exported by the library, include the generated header file and then decorate those declarations with the all-uppercase keyword <code>STEM_API</code> as in these examples:</p>

<pre>    LIBCOM_API void epicsExit(int status);
    LIBCOM_API int asCheckClientIP;
    class LIBCOM_API epicsTime { ... }
    LIBCOM_API virtual ~fdManager ();</pre>

<p>The generated header file also defines a second macro <code>epicsStdCall</code> which on Windows expands to <code>__stdcall</code> to indicate the calling convention for this routine. When used, this macro should be placed between the return type and the routine name, like this:</p>

<pre>    LIBCOM_API int epicsStdCall iocshCmd(const char *cmd);</pre>

<p>It is possible to build more than one shared library in the same Makefile, although each C or C++ source file can only be included in one library. Just repeat the above instructions, using different stems for each library.</p>

<h1><a class='u'
name="COPYRIGHT-AND-LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright (C) 2020 UChicago Argonne LLC, as Operator of Argonne National Laboratory.</p>

<p>This software is distributed under the terms of the EPICS Open License.</p>

<!-- end doc -->

</body></html>
