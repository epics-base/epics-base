<html><head><title>Subroutine Record (sub)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="style.css">

</head>
<body class='pod'>
<!--
  generated by EPICS::PodHtml v,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.028001 at Tue Jul 28 14:39:17 2020 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to EPICS::PodHtml, and/or subclassing EPICS::PodHtml,
   then reconverting this document from the Pod source.
   When in doubt, email the author of EPICS::PodHtml for advice.
   See 'perldoc EPICS::PodHtml' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>
<div class="pod">


<h1><a class='u'
name="Subroutine-Record-(sub)"
>Subroutine Record (sub)</a></h1>

<p>The subroutine record is used to call a C initialization routine and a recurring scan routine.
There is no device support for this record.</p>

<h2><a class='u'
name="Parameter-Fields"
>Parameter Fields</a></h2>

<p>The record-specific fields are described below,
grouped by functionality.</p>

<h3><a class='u'
name="Scan-Parameters"
>Scan Parameters</a></h3>

<p>The subroutine record has the standard fields for specifying under what circumstances it will be processed.
These fields are described in <a href="dbCommonRecord.html#Scan-Fields" class="podlinkpod"
>Scan Fields</a>.</p>

<h3><a class='u'
name="Read-Parameters"
>Read Parameters</a></h3>

<p>The subroutine record has twelve input links (INPA-INPL),
each of which has a corresponding value field (A-L).
These fields are used to retrieve and store values that can be passed to the subroutine that the record calls.</p>

<p>The input links can be either channel access or database links,
or constants.
When constants,
the corresponding value field for the link is initialized with the constant value and the field&#39;s value can be changed at run-time via dbPuts.
Otherwise,
the values for (A-F) are fetched from the input links when the record is processed.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">INPA</td><td class="cell">Input A</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPB</td><td class="cell">Input B</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPC</td><td class="cell">Input C</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPD</td><td class="cell">Input D</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPE</td><td class="cell">Input E</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPF</td><td class="cell">Input F</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPG</td><td class="cell">Input G</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPH</td><td class="cell">Input H</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPI</td><td class="cell">Input I</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPJ</td><td class="cell">Input J</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPK</td><td class="cell">Input K</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">INPL</td><td class="cell">Input L</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">A</td><td class="cell">Value of Input A</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">B</td><td class="cell">Value of Input B</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">C</td><td class="cell">Value of Input C</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">D</td><td class="cell">Value of Input D</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">E</td><td class="cell">Value of Input E</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">F</td><td class="cell">Value of Input F</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">G</td><td class="cell">Value of Input G</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">H</td><td class="cell">Value of Input H</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">I</td><td class="cell">Value of Input I</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">J</td><td class="cell">Value of Input J</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">K</td><td class="cell">Value of Input K</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">L</td><td class="cell">Value of Input L</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

</table></blockquote>


<h3><a class='u'
name="Subroutine-Connection"
>Subroutine Connection</a></h3>

<p>These fields are used to connect to the C subroutine.
The name of the subroutine should be entered in the SNAM field.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">INAM</td><td class="cell">Init Routine Name</td><td class="cell">STRING [40]</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">SNAM</td><td class="cell">Subroutine Name</td><td class="cell">STRING [40]</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Operator-Display-Parameters"
>Operator Display Parameters</a></h3>

<p>These parameters are used to present meaningful data to the operator.
They display the value and other parameters of the subroutine either textually or graphically.</p>

<p>EGU is a string of up to 16 characters that could describe any units used by the subroutine record.
It is retrieved by the <code>get_units</code> record support routine.</p>

<p>The HOPR and LOPR fields set the upper and lower display limits for the VAL,
A-L,
LA-LL,
HIHI,
LOLO,
LOW,
and HIGH fields.
Both the <code>get_graphic_double</code> and <code>get_control_double</code> record support routines retrieve these fields.</p>

<p>The PREC field determines the floating point precision with which to display VAL.
It is used whenever the <code>get_precision</code> record support routine is called.</p>

<p>See <a href="dbCommonRecord.html#Operator-Display-Parameters" class="podlinkpod"
>Fields Common to All Record Types</a> for more on the record name (NAME) and description (DESC) fields.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">EGU</td><td class="cell">Engineering Units</td><td class="cell">STRING [16]</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">HOPR</td><td class="cell">High Operating Range</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">LOPR</td><td class="cell">Low Operating Range</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">PREC</td><td class="cell">Display Precision</td><td class="cell">SHORT</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">NAME</td><td class="cell">Record Name</td><td class="cell">STRING [61]</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">DESC</td><td class="cell">Descriptor</td><td class="cell">STRING [41]</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Alarm-Parameters"
>Alarm Parameters</a></h3>

<p>The possible alarm conditions for subroutine records are the SCAN,
READ,
limit alarms,
and an alarm that can be triggered if the subroutine returns a negative value.
The SCAN and READ alarms are called by the record or device support routines.
The limit alarms are configured by the user in the HIHI,
LOLO,
HIGH,
and LOW fields using numerical values.
They apply to the VAL field.
For each of these fields,
there is a corresponding severity field which can be either NO_ALARM,
MINOR,
or MAJOR.</p>

<p>The BRSV field is where the user can set the alarm severity in case the subroutine returns a negative value.</p>

<p><a href="dbCommonRecord.html#Alarm-Fields" class="podlinkpod"
>Alarm Fields</a> lists the fields related to alarms that are common to all record types.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">HIHI</td><td class="cell">Hihi Alarm Limit</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">HIGH</td><td class="cell">High Alarm Limit</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">LOW</td><td class="cell">Low Alarm Limit</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">LOLO</td><td class="cell">Lolo Alarm Limit</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">HHSV</td><td class="cell">Hihi Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">HSV</td><td class="cell">High Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">LSV</td><td class="cell">Low Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">LLSV</td><td class="cell">Lolo Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">BRSV</td><td class="cell">Bad Return Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">HYST</td><td class="cell">Alarm Deadband</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Monitor-Parameters"
>Monitor Parameters</a></h3>

<p>These parameters are used to determine when to send monitors placed on the VAL field.
The appropriate monitors are invoked when VAL differs from the values in the ALST and MLST run-time fields,
i.e.,
when the value of VAL changes by more than the deadband specified in these fields.
The ADEL and MDEL fields specify a minimum delta which the change must surpass before the value-change monitors are invoked.
If these fields have a value of zero,
everytime the value changes,
a monitor will be triggered; if they have a value of -1,
everytime the record is processed,
monitors are triggered.
The ADEL field is used by archive monitors and the MDEL field for all other types of monitors.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">ADEL</td><td class="cell">Archive Deadband</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">MDEL</td><td class="cell">Monitor Deadband</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Run-time-Parameters"
>Run-time Parameters</a></h3>

<p>These parameters are used by the run-time code for processing the subroutine record.
They are not configured using a database configuration tool.
They represent the current state of the record.
Many of them are used by the record processing routines or the monitors.</p>

<p>VAL should be set by the subroutine.
SADR holds the subroutine address and is set by the record processing routine.</p>

<p>The rest of these fields--LALM,
ALST,
MLST,
and the LA-LL fields--are used to implement the monitors.
For example,
when LA is not equal to A,
the value-change monitors are called for that field.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">VAL</td><td class="cell">Result</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">SADR</td><td class="cell">Subroutine Address</td><td class="cell">NOACCESS</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">No</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LALM</td><td class="cell">Last Value Alarmed</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">ALST</td><td class="cell">Last Value Archived</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">MLST</td><td class="cell">Last Value Monitored</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LA</td><td class="cell">Prev Value of A</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LB</td><td class="cell">Prev Value of B</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LC</td><td class="cell">Prev Value of C</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LD</td><td class="cell">Prev Value of D</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LE</td><td class="cell">Prev Value of E</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LF</td><td class="cell">Prev Value of F</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LG</td><td class="cell">Prev Value of G</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LH</td><td class="cell">Prev Value of H</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LI</td><td class="cell">Prev Value of I</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LJ</td><td class="cell">Prev Value of J</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LK</td><td class="cell">Prev Value of K</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">LL</td><td class="cell">Prev Value of L</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

</table></blockquote>


<h2><a class='u'
name="Record-Support"
>Record Support</a></h2>

<h3><a class='u'
name="Record-Support-Routines"
>Record Support Routines</a></h3>

<h4><a class='u'
name="init_record"
>init_record</a></h4>

<pre>  long (*init_record)(struct dbCommon *precord, int pass)</pre>

<p>For each constant input link, the corresponding value field is initialized with the constant value. For each input link that is of type PV_LINK, a channel access link is created.</p>

<p>If an initialization subroutine is defined, it is located and called.</p>

<p>The processing subroutine is located and its address stored in SADR.</p>

<h4><a class='u'
name="process"
>process</a></h4>

<pre>  long (*process)(struct dbCommon *precord)</pre>

<p>See <a href="#Record-Processing" class="podlinkpod"
>&#34;Record Processing&#34;</a>.</p>

<h4><a class='u'
name="get_units"
>get_units</a></h4>

<pre>  long (*get_units)(struct dbAddr *paddr, char *units)</pre>

<p>Retrieves EGU.</p>

<h4><a class='u'
name="get_precision"
>get_precision</a></h4>

<pre>  long (*get_precision)(const struct dbAddr *paddr, long *precision)</pre>

<p>Retrieves PREC when VAL is the field being referenced. Otherwise, calls <code>recGblGetPrec()</code>.</p>

<h4><a class='u'
name="get_graphic_double"
>get_graphic_double</a></h4>

<pre>  long (*get_graphic_double)(struct dbAddr *paddr, struct dbr_grDouble *p)</pre>

<p>Sets the upper display and lower display limits for a field. If the field is VAL, A-L, LA-LL, HIHI, HIGH, LOW, or LOLO, the limits are set to HOPR and LOPR, else if the field has upper and lower limits defined they will be used, else the upper and lower maximum values for the field type will be used.</p>

<h4><a class='u'
name="get_control_double"
>get_control_double</a></h4>

<pre>  long (*get_control_double)(struct dbAddr *paddr, struct dbr_ctrlDouble *p)</pre>

<p>Sets the upper control and the lower control limits for a field. If the field is VAL, A-L, LA-LL, HIHI, HIGH, LOW, or LOLO, the limits are set to HOPR and LOPR, else if the field has upper and lower limits defined they will be used, else the upper and lower maximum values for the field type will be used.</p>

<h4><a class='u'
name="get_alarm_double"
>get_alarm_double</a></h4>

<pre>  long (*get_alarm_double)(struct dbAddr *paddr, struct dbr_alDouble *p)</pre>

<p>Sets the following values:</p>

<pre>  upper_alarm_limit = HIHI
  upper_warning_limit = HIGH
  lower_warning_limit = LOW
  lower_alarm_limit = LOLO</pre>

<h3><a class='u'
name="Record-Processing"
>Record Processing</a></h3>

<p>Routine process implements the following algorithm:</p>

<ol>
<li>If PACT is FALSE then fetch all arguments.</li>

<li>Call the subroutine and check return value.
<ul>
<li>Call subroutine</li>

<li>Set PACT TRUE</li>

<li>If return value is 1, return</li>
</ul>
</li>

<li>Check alarms. This routine checks to see if the new VAL causes the alarm status and severity to change. If so, NSEV, NSTA and LALM are set. It also honors the alarm hysteresis factor (HYST). Thus the value must change by more than HYST before the alarm status and severity is lowered.</li>

<li>Check to see if monitors should be invoked.
<ul>
<li>Alarm monitors are invoked if the alarm status or severity has changed.</li>

<li>Archive and value change monitors are invoked if ADEL and MDEL conditions are met.</li>

<li>Monitors for A-L are invoked if value has changed.</li>

<li>NSEV and NSTA are reset to 0.</li>
</ul>
</li>

<li>Scan forward link if necessary, set PACT FALSE, and return.</li>
</ol>

<h3><a class='u'
name="Example-Synchronous-Subroutine"
>Example Synchronous Subroutine</a></h3>

<p>This is an example subroutine that merely increments VAL each time process is called.</p>

<pre>  #include &#60;stdio.h&#62;
  #include &#60;dbDefs.h&#62;
  #include &#60;subRecord.h&#62;
  #include &#60;registryFunction.h&#62;
  #include &#60;epicsExport.h&#62;

  static long subInit(struct subRecord *psub)
  {
      printf(&#34;subInit was called\n&#34;);
      return 0;
  }

  static long subProcess(struct subRecord *psub)
  {
      psub-&#62;val++;
      return 0;
  }

  epicsRegisterFunction(subInit);
  epicsRegisterFunction(subProcess);</pre>

<h3><a class='u'
name="Example-Asynchronous-Subroutine"
>Example Asynchronous Subroutine</a></h3>

<p>This example for a VxWorks IOC shows an asynchronous subroutine. It uses (actually misuses) fields A and B. Field A is taken as the number of seconds until asynchronous completion. Field B is a flag to decide if messages should be printed. Lets assume A &#62; 0 and B = 1. The following sequence of actions will occcur:</p>

<ol>
<li>subProcess is called with pact FALSE. It performs the following steps.
<ul>
<li>Computes, from A, the number of ticks until asynchronous completion should occur.</li>

<li>Prints a message stating that it is requesting an asynchronous callback.</li>

<li>Calls the vxWorks watchdog start routine.</li>

<li>Sets pact TRUE and returns a value of 0. This tells record support to complete without checking alarms, monitors, or the forward link.</li>
</ul>
</li>

<li>When the time expires, the system wide callback task calls myCallback. myCallback locks the record, calls process, and unlocks the record.</li>

<li>Process again calls subProcess, but now pact is TRUE. Thus the following is done:
<ul>
<li>VAL is incremented.</li>

<li>A completion message is printed.</li>

<li>subProcess returns 0. The record processing routine will complete record processing.</li>
</ul>
</li>
</ol>

<pre>  #include &#60;types.h&#62;
  #include &#60;stdio.h&#62;
  #include &#60;wdLib.h&#62;
  #include &#60;callback.h&#62;
  #include &#60;dbDefs.h&#62;
  #include &#60;dbAccess.h&#62;
  #include &#60;subRecord.h&#62;

  /* control block for callback*/
  struct callback {
      epicsCallback callback;
      struct dbCommon *precord;
      WDOG_ID wd_id;
  };

  void myCallback(struct callback *pcallback)
  {
      struct dbCommon *precord=pcallback-&#62;precord;
      struct rset *prset=(struct rset *)(precord-&#62;rset);
      dbScanLock(precord);
      (*prset-&#62;process)(precord);
      dbScanUnlock(precord);
  }

  long subInit(struct subRecord *psub)
  {
      struct callback *pcallback;
      pcallback = (struct callback *)(calloc(1,sizeof(struct callback)));
      psub-&#62;dpvt = (void *)pcallback;
      callbackSetCallback(myCallback,pcallback);
      pcallback-&#62;precord = (struct dbCommon *)psub;
      pcallback-&#62;wd_id = wdCreate();
      printf(&#34;subInit was called\n&#34;);
      return 0;
  }

  long subProcess(struct subRecord *psub)
  {
      struct callback *pcallback=(struct callback *)(psub-&#62;dpvt);
      /* sub.inp must be a CONSTANT*/
      if (psub-&#62;pact) {
          psub-&#62;val++;
          if (psub-&#62;b)
          printf(&#34;%s subProcess Completed\n&#34;, psub-&#62;name);
          return 0;
      } else {
          int wait_time = (long)(psub-&#62;a * vxTicksPerSecond);
          if (wait_time &#60;= 0){
              if (psub-&#62;b)
                  printf(&#34;%s subProcess sync processing\n&#34;, psub-&#62;name);
              psub-&#62;pact = TRUE;
              return 0;
          }
          if (psub-&#62;b){
              callbackSetPriority(psub-&#62;prio, pcallback);
              printf(&#34;%s Starting async processing\n&#34;, psub-&#62;name);
              wdStart(pcallback-&#62;wd_id, wait_time, callbackRequest, (int)pcallback);
              return 1;
          }
      }
      return 0;
  }</pre>
</div>


<!-- end doc -->

</body></html>
