<html><head><title>filters</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="style.css">

</head>
<body class='pod'>
<!--
  generated by EPICS::PodHtml v,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.028001 at Tue Jul 28 14:39:18 2020 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to EPICS::PodHtml, and/or subclassing EPICS::PodHtml,
   then reconverting this document from the Pod source.
   When in doubt, email the author of EPICS::PodHtml for advice.
   See 'perldoc EPICS::PodHtml' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>
<div class="pod">


<h1><a class='u'
name="Channel-Filters"
>Channel Filters</a></h1>

<p>Channel Filters can be applied to Channel Access channels by a client,
using a JSON Field Modifier to select the filter and any parameters.
The following filters are available in this release:</p>

<ul>
<li><a href="#TimeStamp-Filter-ts" class="podlinkpod"
>TimeStamp</a></li>

<li><a href="#Deadband-Filter-dbnd" class="podlinkpod"
>Deadband</a></li>

<li><a href="#Array-Filter-arr" class="podlinkpod"
>Array</a></li>

<li><a href="#Synchronize-Filter-sync" class="podlinkpod"
>Synchronize</a></li>

<li><a href="#Decimation-Filter-dec" class="podlinkpod"
>Decimation</a></li>
</ul>

<h2><a class='u'
name="Using-Filters"
>Using Filters</a></h2>

<p>Channel filters can be added to any Channel Access channel name.
There can be more than one filter applied to the same channel,
in which case the order that they are specified will control the order in which they are applied to the resulting data-stream.
The filter specification must appear after the field name,
or if the default (VAL) field is used after a dot <code>.</code> appended to the record name.
With the exception of the array short-hand which is described below,
all filters must appear inside a pair of braces <code> {} </code> after the dot expressed as a JSON (<a href="http://www.json.org/" class="podlinkurl"
>JavaScript Object Notation</a>) object,
which allows filter parameters to be included as needed.</p>

<p>Each filter is given as a name/value pair.
The filter name (given in parentheses in the titles below) is a string,
and must be enclosed inside double-quotes <code>&#34;</code> characters as per the JSON specification.
Parameters to that filter are provided as the value part of the name/value pair,
and will normally appear as a child JSON object consisting of name/value pairs inside a nested pair of braces <code> {} </code>.</p>

<h4><a class='u'
name="Example-Filter"
>Example Filter</a></h4>

<p>Given a record called <code>test:channel</code> the following would apply a filter <code>f</code> to the VAL field of that record,
giving the filter two numeric parameters named <code>lo</code> and <code>hi</code>:</p>

<pre> test:channel.{&#34;f&#34;:{&#34;lo&#34;:0,&#34;hi&#34;:10}}</pre>

<p>Note that due to the required presence of the double-quote characters in the JSON strings in the name string, it will usually be necessary to enclose a filtered name within single-quotes <code>&#39; ... &#39;</code> when typing it as an argument to a Unix shell command.</p>

<h2><a class='u'
name="Filter-Reference"
>Filter Reference</a></h2>

<h3><a class='u'
name="TimeStamp-Filter-&#34;ts&#34;"
>TimeStamp Filter <code>&#34;ts&#34;</code></a></h3>

<p>This filter is used to set the timestamp of the value fetched through the channel to the time the value was fetched (or an update was sent), rather than the time the record last processed which could have been days or even weeks ago for some records, or set to the EPICS epoch if the record has never processed.</p>

<h4><a class='u'
name="Parameters"
>Parameters</a></h4>

<p>None, use an empty pair of braces.</p>

<h4><a class='u'
name="Example"
>Example</a></h4>

<pre> Hal$ caget -a &#39;test:channel.{&#34;ts&#34;:{}}&#39;
 test:channel.{&#34;ts&#34;:{}}   2012-08-28 22:10:31.192547 0 UDF INVALID
 Hal$ caget -a &#39;test:channel&#39;
 test:channel             &#60;undefined&#62; 0 UDF INVALID</pre>

<h3><a class='u'
name="Deadband-Filter-&#34;dbnd&#34;"
>Deadband Filter <code>&#34;dbnd&#34;</code></a></h3>

<p>This filter implements a channel-specific monitor deadband, which is applied after any deadbands implemented by the record itself (it can only drop updates that the unfiltered channel generates, never add additional updates).</p>

<p>The deadband can be specified as an absolute value change, or as a relative percentage.</p>

<h4><a class='u'
name="Parameters"
>Parameters</a></h4>

<dl>
<dt><a name="Mode+Deadband-&#34;abs&#34;/&#34;rel&#34;-(shorthand)"
>Mode+Deadband <code>&#34;abs&#34;</code>/<code>&#34;rel&#34;</code> (shorthand)</a></dt>

<dd>
<p>Mode and deadband can be specified in one definition (shorthand). The desired mode is given as parameter name (<code>&#34;abs&#34;</code> or <code>&#34;rel&#34;</code>), with the numeric size of the deadband (absolute value or numeric percentage) as value.</p>

<dt><a name="Deadband-&#34;d&#34;"
>Deadband <code>&#34;d&#34;</code></a></dt>

<dd>
<p>The size of the deadband to use. Relative deadband values are given as a numeric percentage, but without any trailing percent character.</p>

<dt><a name="Mode-&#34;m&#34;-(optional)"
>Mode <code>&#34;m&#34;</code> (optional)</a></dt>

<dd>
<p>A string (enclosed in double-quotes <code>&#34;</code>), which should contain either <code>abs</code> or <code>rel</code>. The default mode is <code>abs</code> if no mode parameter is included.</p>
</dd>
</dl>

<h4><a class='u'
name="Example"
>Example</a></h4>

<pre> Hal$ camonitor &#39;test:channel&#39;
 test:channel                    2012-09-01 22:10:19.600595 1 LOLO MAJOR
 test:channel                    2012-09-01 22:10:20.600661 2 LOLO MAJOR
 test:channel                    2012-09-01 22:10:21.600819 3 LOW MINOR
 test:channel                    2012-09-01 22:10:22.600905 4 LOW MINOR
 test:channel                    2012-09-01 22:10:23.601023 5  
 test:channel                    2012-09-01 22:10:24.601136 6 HIGH MINOR
 ^C
 Hal$ camonitor &#39;test:channel.{&#34;dbnd&#34;:{&#34;abs&#34;:1.5}}&#39;
 test:channel.{&#34;dbnd&#34;:{&#34;d&#34;:1.5}} 2012-09-01 22:11:49.613341 1 LOLO MAJOR
 test:channel.{&#34;dbnd&#34;:{&#34;d&#34;:1.5}} 2012-09-01 22:11:51.613615 3 LOW MINOR
 test:channel.{&#34;dbnd&#34;:{&#34;d&#34;:1.5}} 2012-09-01 22:11:53.613804 5  
 test:channel.{&#34;dbnd&#34;:{&#34;d&#34;:1.5}} 2012-09-01 22:11:55.614074 7 HIGH MINOR
 test:channel.{&#34;dbnd&#34;:{&#34;d&#34;:1.5}} 2012-09-01 22:11:57.614305 9 HIHI MAJOR
 ^C</pre>

<h3><a class='u'
name="Array-Filter-&#34;arr&#34;"
>Array Filter <code>&#34;arr&#34;</code></a></h3>

<p>This filter is used to retrieve parts of an array (subarrays and strided subarrays).</p>

<h4><a class='u'
name="Parameters"
>Parameters</a></h4>

<p>Note: Negative index numbers address from the end of the array, with <code>-1</code> being the last element.</p>

<dl>
<dt><a name="Square-bracket-notation-[start:increment:end]-(shorthand)"
>Square bracket notation <code>[start:increment:end]</code> (shorthand)</a></dt>

<dd>
<p>The common square bracket notation which can be used in place of JSON. Any parameter may be omitted (keeping the colons) to use the default value. If only one colon is included, this means <code>[start:end]</code> with an increment of 1. If only a single parameter is used <code>[index]</code> the filter returns one element.</p>

<dt><a name="Start-index-&#34;s&#34;"
>Start index <code>&#34;s&#34;</code></a></dt>

<dd>
<p>Index of the first original array element to retrieve.</p>

<dt><a name="Increment-&#34;i&#34;"
>Increment <code>&#34;i&#34;</code></a></dt>

<dd>
<p>Index increment between retrieved elements of the original array; must be a positive number.</p>

<dt><a name="End-index-&#34;e&#34;"
>End index <code>&#34;e&#34;</code></a></dt>

<dd>
<p>Index of the last original array element to retrieve.</p>
</dd>
</dl>

<p>Defaults (when parameters are omitted) are: <code>s=0</code> (first element), <code>i=1</code> (fetch all elements), <code>e=-1</code> (last element)</p>

<h4><a class='u'
name="Example"
>Example</a></h4>

<pre> Hal$ caget test:channel &#39;test:channel.{&#34;arr&#34;:{&#34;s&#34;:2,&#34;i&#34;:2,&#34;e&#34;:8}}&#39; test:channel.[3:5] test:channel.[3:2:-3]
 test:channel 10 0 1 2 3 4 5 6 7 8 9
 test:channel.{&#34;arr&#34;:{&#34;s&#34;:2,&#34;i&#34;:2,&#34;e&#34;:8}} 4 2 4 6 8
 test:channel.[3:5] 3 3 4 5
 test:channel.[3:2:-3] 3 3 5 7</pre>

<h3><a class='u'
name="Synchronize-Filter-&#34;sync&#34;"
>Synchronize Filter <code>&#34;sync&#34;</code></a></h3>

<p>This filter is used to dynamically enable or disable monitors according to a condition and a state variable declared by the IOC.</p>

<p>State variables have a boolean value and can be set by a binary output record, an iocsh command or by other software running in the IOC calling <code>dbStateSet()</code>.</p>

<h4><a class='u'
name="Parameters"
>Parameters</a></h4>

<dl>
<dt><a name="Mode+State"
>Mode+State</a></dt>

<dd>
<p>Mode and state can be specified in one definition (shorthand). The desired mode is given as parameter name (<code>&#34;before&#34;</code> / <code>&#34;first&#34;</code> / <code>&#34;while&#34;</code> / <code>&#34;last&#34;</code> / <code>&#34;after&#34;</code> / <code>&#34;unless&#34;</code>), with the state name (enclosed in double quotes <code>&#34;</code>) as value.</p>

<dt><a name="Mode-&#34;m&#34;"
>Mode <code>&#34;m&#34;</code></a></dt>

<dd>
<p>A single word from the list below, enclosed in double quotes <code>&#34;</code>. This controls how the state value should affect the monitor stream.</p>

<dl>
<dt><a name="&#34;before&#34;--only-the-last-value-received-before-the-state-changes-from-false-to-true-is-forwarded-to-the-client."
><code>&#34;before&#34;</code> &#8212; only the last value received before the state changes from false to true is forwarded to the client.</a></dt>

<dd>
<dt><a name="&#34;first&#34;--only-the-first-value-received-after-the-state-changes-from-true-to-false-is-forwarded-to-the-client."
><code>&#34;first&#34;</code> &#8212; only the first value received after the state changes from true to false is forwarded to the client.</a></dt>

<dd>
<dt><a name="&#34;while&#34;--values-are-forwarded-to-the-client-as-long-as-the-state-is-true."
><code>&#34;while&#34;</code> &#8212; values are forwarded to the client as long as the state is true.</a></dt>

<dd>
<dt><a name="&#34;last&#34;--only-the-last-value-received-before-the-state-changes-from-true-to-false-is-forwarded-to-the-client."
><code>&#34;last&#34;</code> &#8212; only the last value received before the state changes from true to false is forwarded to the client.</a></dt>

<dd>
<dt><a name="&#34;after&#34;--only-the-first-value-received-after-the-state-changes-from-true-to-false-is-forwarded-to-the-client."
><code>&#34;after&#34;</code> &#8212; only the first value received after the state changes from true to false is forwarded to the client.</a></dt>

<dd>
<dt><a name="&#34;unless&#34;--values-are-forwarded-to-the-client-as-long-as-the-state-is-false."
><code>&#34;unless&#34;</code> &#8212; values are forwarded to the client as long as the state is false.</a></dt>
</dl>

<dt><a name="State-&#34;s&#34;"
>State <code>&#34;s&#34;</code></a></dt>

<dd>
<p>The name of a state variable, enclosed in double quotes <code>&#34;</code>.</p>
</dd>
</dl>

<h4><a class='u'
name="Example"
>Example</a></h4>

<p>Assuming there is a system state called &#34;blue&#34;, that is being controlled by some other facility such as a timing system, updates could be restricted to periods only when &#34;blue&#34; is true by using</p>

<pre> Hal$ camonitor &#39;test:channel&#39; &#39;test:channel.{&#34;sync&#34;:{&#34;while&#34;:&#34;blue&#34;}}&#39;
 ...</pre>

<h3><a class='u'
name="Decimation-Filter-&#34;dec&#34;"
>Decimation Filter <code>&#34;dec&#34;</code></a></h3>

<p>This filter is used to reduce the number or rate of monitor updates from a channel by an integer factor <code>n</code> that is provided as a filter argument, discarding the other updates. A true decimation following the original meaning of the word would be achieved by giving <code>n</code> as 10, to only allow every tenth update through.</p>

<h4><a class='u'
name="Parameters"
>Parameters</a></h4>

<dl>
<dt><a name="Number-&#34;n&#34;"
>Number <code>&#34;n&#34;</code></a></dt>

<dd>
<p>The decimation factor, a positive integer. Giving n=1 is equivalent to a no-op that allows all updates to be passed to the client.</p>
</dd>
</dl>

<p>This filter is intentionally very simplistic. It passes on the first monitor event that it sees after the channel connects, then discards the next N-1 events before sending the next event. If several clients connect to a channel using the same filter settings they may see completely different data streams since each client gets its own instance of the filter whose event counter starts when that client connects.</p>

<h4><a class='u'
name="Example"
>Example</a></h4>

<p>To sample a 60Hz channel at 1Hz, a 10Hz channel every 6 seconds or a 1Hz channel once every minute:</p>

<pre> Hal$ camonitor &#39;test:channel&#39; &#39;test:channel.{&#34;dec&#34;:{&#34;n&#34;:60}}&#39;
 ...</pre>
</div>


<!-- end doc -->

</body></html>
